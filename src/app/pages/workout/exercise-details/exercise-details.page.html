<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button (click)="goBack()" defaultHref="/main"></ion-back-button>
    </ion-buttons>
    <ion-title>La tua scheda</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="container bg-gradient" fullscreen>
    <ion-refresher slot="fixed" (ionRefresh)="onRefresh($event)">
        <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

    <div *ngIf="isLoading" class="loading-container">
        <ion-spinner name="crescent"></ion-spinner>
        <p>{{ environment.ln.generalLoading }}</p>
    </div>

    <div *ngIf="!isLoading && !exercise" class="no-content">
        <div class="icon">
        <img src="assets/images/icon-workout.svg" alt="Allenamento">
        </div>
        <h3>Esercizio non trovato</h3>
        <p>Non Ã¨ stato possibile caricare i dettagli dell'esercizio.</p>
        <ion-button expand="block" fill="clear" color="danger" (click)="goBack()">Torna indietro</ion-button>
    </div>

    <div *ngIf="!isLoading && exercise" class="exercise-content">
        
        <!-- Indicatore superset -->
        <div *ngIf="isSuperset" class="superset-header">
            <div class="superset-badge">
                <span class="superset-label">SUPERSET</span>
                <div class="superset-indicator">
                    <span class="current">{{ currentSupersetIndex + 1 }}</span>
                    <span class="separator">/</span>
                    <span class="total">{{ exercises.length }}</span>
                </div>
            </div>
            
            <!-- Navigation arrows -->
            <div class="superset-navigation">
                <button 
                    class="nav-btn prev" 
                    (click)="prevExercise()"
                    [disabled]="!isSuperset">
                    <ion-icon name="chevron-back-outline"></ion-icon>
                </button>
                <button 
                    class="nav-btn next" 
                    (click)="nextExercise()"
                    [disabled]="!isSuperset">
                    <ion-icon name="chevron-forward-outline"></ion-icon>
                </button>
            </div>
        </div>

        <!-- Carousel container -->
        <div class="exercise-carousel" 
             (pan)="onSwipe($event)"
             (touchstart)="onTouchStart($event)"
             (touchmove)="onTouchMove($event)"
             (touchend)="onTouchEnd($event)"
             (mousedown)="onMouseDown($event)"
             (mousemove)="onMouseMove($event)"
             (mouseup)="onMouseUp($event)"
             #carouselContainer>
            
            <!-- Single exercise -->
            <div *ngIf="!isSuperset" class="exercise-slide active">
                <div class="exercise-info">
                    <div class="exercise-title">{{ exercise.descrizione }}</div>
                    
                    <div class="exercise-meta-double">
                        <div *ngIf="exercise.tipo == 'reps'" class="detail">
                            <span class="label">Serie e ripetizioni</span>
                            <span class="value">{{ exercise.serie }}</span>
                        </div>
                        <div *ngIf="exercise.tipo == 'time'" class="detail">
                            <span class="label">Serie a tempo</span>
                            <span class="value">{{ exercise.serie }} x {{ exercise.durata }}</span>
                        </div>
                        <div class="detail">
                            <span class="label">Kg</span>
                            <span class="value">{{ exercise.kg }}</span>
                        </div>
                    </div>

                    <div class="exercise-meta-single">
                        <span class="label">Recupero</span>
                        <span class="value">{{ exercise.recupero }}</span>
                    </div>

                    <div *ngIf="exercise.note" class="exercise-meta-single">
                        <span class="label">Note</span>
                        <span class="value">{{ exercise.note }}</span>
                    </div>

                    <ion-button *ngIf="exercise.video || exercise.images?.length || exercise.testo" class="button exercise-explanation" expand="block" (click)="exerciseExplanation()" [disabled]="isLoading || isOpeningModal">Spiegazione esercizio <ion-icon name="caret-forward-circle-outline"></ion-icon></ion-button>
                    <ion-button class="button workout-start" expand="block" (click)="workoutStart()" [disabled]="isLoading">Inizia ad allenarti</ion-button>
                    
                    <img *ngIf="exercise.thumb" class="exercise-cover" [src]="exercise.thumb" [alt]="exercise.descrizione" />
                </div>
            </div>

            <!-- Superset slides -->
            <div *ngIf="isSuperset" 
                 class="exercise-slides-container"
                 [style.transform]="'translateX(' + (-currentSupersetIndex * 100) + '%)'">
                
                <div *ngFor="let exerciseItem of exercises; let i = index" 
                     class="exercise-slide"
                     [class.active]="i === currentSupersetIndex">
                    
                    <div class="exercise-info">
                        <div class="exercise-title">{{ exerciseItem.descrizione }}</div>
                        
                        <div class="exercise-meta-double">
                            <div *ngIf="exerciseItem.tipo == 'reps'" class="detail">
                                <span class="label">Serie e ripetizioni</span>
                                <span class="value">{{ exerciseItem.serie }}</span>
                            </div>
                            <div *ngIf="exerciseItem.tipo == 'time'" class="detail">
                                <span class="label">Serie a tempo</span>
                                <span class="value">{{ exerciseItem.serie }} x {{ exerciseItem.durata }}</span>
                            </div>
                            <div class="detail">
                                <span class="label">Kg</span>
                                <span class="value">{{ exerciseItem.kg }}</span>
                            </div>
                        </div>

                        <div class="exercise-meta-single">
                            <span class="label">Recupero</span>
                            <span class="value">{{ exerciseItem.recupero }}</span>
                        </div>

                        <div *ngIf="exerciseItem.note" class="exercise-meta-single">
                            <span class="label">Note</span>
                            <span class="value">{{ exerciseItem.note }}</span>
                        </div>

                        <ion-button class="button exercise-explanation" expand="block" (click)="exerciseExplanation()" [disabled]="isLoading || isOpeningModal">Spiegazione esercizio <ion-icon name="caret-forward-circle-outline"></ion-icon></ion-button>
                        <ion-button class="button workout-start" expand="block" (click)="workoutStart()" [disabled]="isLoading">Inizia ad allenarti</ion-button>
                        
                        <img *ngIf="exercise.thumb" class="exercise-cover" [src]="exerciseItem.thumb" [alt]="exercise.descrizione" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</ion-content>